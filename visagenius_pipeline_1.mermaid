flowchart TD
    classDef userAction fill:#451a03,stroke:#f59e0b,color:#fde68a,stroke-width:2px
    classDef aiStep fill:#134e4a,stroke:#0d9488,color:#5eead4,stroke-width:1px
    classDef output fill:#3b1764,stroke:#a855f7,color:#c084fc,stroke-width:1px
    classDef critical fill:#450a0a,stroke:#ef4444,color:#fca5a5,stroke-width:2px
    classDef phase fill:#1e293b,stroke:#475569,color:#e2e8f0,stroke-width:2px
    classDef decision fill:#78350f,stroke:#f59e0b,color:#fde68a,stroke-width:2px

    %% ============ PHASE 1: INITIAL ASSESSMENT ============
    PH1[/"ğŸ” PHASE 1 â€” INITIAL ASSESSMENT"/]:::phase

    U1["ğŸ“„ Upload Resume / CV<br/>(PDF, TXT, DOC)"]:::userAction
    U2["ğŸ“ Answer 5 Intake Questions<br/>Passion Â· Job Â· Resources Â· Plans Â· Why PR"]:::userAction

    S1["S1: Document Classification<br/>Type detection Â· 99% confidence Â· ~1.4s"]:::aiStep
    S2["S2: Resume Parsing & Criteria Mapping<br/>Entity extraction Â· C1â€“C10 mapping Â· 69 items Â· ~53.8s"]:::aiStep
    S3["S3: Criteria Strength Evaluation<br/>Tier scoring (1â€“5) Â· Approval prob Â· RFE risk Â· ~29.9s"]:::aiStep
    S4["S4: Gap Analysis & Action Plan<br/>Critical gaps Â· Remediation steps Â· Cost & timeline Â· ~47.5s"]:::aiStep
    S5["S5: Case Strategy & Filing Plan<br/>Recommended criteria (4) Â· Filing plan Â· ~33.0s"]:::aiStep

    O1(["ğŸ“Š Assessment Outputs<br/>â€¢ Approval probability (85â€“95%)<br/>â€¢ Criteria satisfied (1/10)<br/>â€¢ Top 3 weaknesses<br/>â€¢ Filing recommendation: WAIT 6 MONTHS"]):::output

    PH1 --> U1 & U2
    U1 --> S1
    S1 --> S2
    U2 -.->|"intake context"| S4
    U2 -.->|"intake context"| S5
    S2 --> S3
    S3 --> S4
    S4 --> S5
    S5 --> O1

    %% ============ PHASE 2: EVIDENCE VERIFICATION ============
    PH2[/"ğŸ“ PHASE 2 â€” EVIDENCE VERIFICATION"/]:::phase
    O1 --> PH2

    U3["ğŸ“ Upload 10â€“50+ Evidence Documents<br/>Patents Â· Articles Â· Salary docs Â· Awards Â· Org charts"]:::userAction
    S6["S6: Evidence Classification<br/>Batch classify all docs Â· Type distribution Â· ~18.6s"]:::aiStep
    S7["S7: Criteria Routing & Assignment<br/>Auto-route docs â†’ C1â€“C10 Â· Manual reassign available"]:::aiStep
    D1{"ğŸ‘¤ User reviews<br/>routing & clicks<br/>Verify Evidence"}:::decision
    S8["S8: Evidence Verification (Per Criterion)<br/>Deep verify Â· Red flags Â· Unverified claims Â· INCLUDE/EXCLUDE Â· ~29.1s"]:::aiStep

    O2(["âœ… Verification Outputs<br/>â€¢ 3 criteria verified Â· 12 red flags<br/>â€¢ Include / Exclude per document<br/>â€¢ Strong: 0 Â· Moderate: 0 Â· Weak: 3<br/>â€¢ Missing docs: 0"]):::output

    PH2 --> U3
    U3 --> S6
    S6 --> S7
    S7 --> D1
    D1 -->|"âœ… Verify Evidence"| S8
    S8 --> O2

    %% ============ PHASE 3: CASE CONSOLIDATION ============
    PH3[/"ğŸ§© PHASE 3 â€” CASE CONSOLIDATION"/]:::phase
    O2 --> PH3

    S9["S9: Case Consolidation & Prioritization<br/>Master synthesis Â· Criteria ranking (PRIMARY/BACKUP/DROP)<br/>Petition strategy Â· Letter strategy Â· Risk assessment Â· ~75.6s"]:::aiStep

    O3(["ğŸ“‹ Consolidation Outputs<br/>â€¢ Primary: C8 Â· Backup: C5, C4, C9<br/>â€¢ Drop: C1, C2, C3, C6, C7, C10<br/>â€¢ 6 recommendation letters planned<br/>â€¢ 25-page petition structure<br/>â€¢ 5 gap remediation priorities<br/>â€¢ Kazarian Step 1 & 2 narrative"]):::output

    PH3 --> S9
    S9 --> O3

    %% ============ PHASE 4: RECOMMENDATION LETTERS ============
    PH4[/"âœï¸ PHASE 4 â€” RECOMMENDATION LETTERS"/]:::phase
    O3 --> PH4

    S10["S10: Recommender Input & Portfolio Health<br/>Add up to 20 recommenders Â· Name, LinkedIn, Why, Criteria<br/>Portfolio Health Scorecard (independence, diversity, coverage)"]:::userAction
    S11["S11: Recommender Bio Research<br/>AI researches credentials Â· Assesses suitability"]:::aiStep
    S12["S12: Letter Draft Generation & Iteration<br/>AI-drafted letters per recommender Â· Supports refinement"]:::aiStep

    PH4 --> S10
    S10 --> S11
    S11 --> S12

    %% ============ DOCUMENT GENERATION ============
    PH5[/"ğŸ“„ DOCUMENT GENERATION (Steps 13â€“16)"/]:::phase
    S12 --> PH5

    S13["S13: Personal Statement (Exhibit A)<br/>2â€“4 pages Â· First person Â· Uses intake answers<br/>Satisfies 8 CFR 204.5(h)(3)"]:::aiStep
    S14["S14: Petition Cover Letter (I-140)<br/>Primary legal document Â· Kazarian two-prong test<br/>Per-criterion evidence presentation"]:::aiStep
    S15["S15: Executive Resume (Exhibit B)<br/>USCIS-optimized Â· 2â€“4 pages Â· Criterion-mapped<br/>Red flag items auto-excluded"]:::aiStep
    S16["S16: Exhibit List<br/>Standard order: A (PS) â†’ B (Resume) â†’ C+ (Letters)<br/>â†’ Evidence by Criterion â†’ Identity Documents"]:::aiStep

    PH5 --> S13 & S14 & S15 & S16

    %% ============ FINAL REVIEW ============
    PH6[/"ğŸ”’ FINAL REVIEW & FILING (Steps 17â€“18)"/]:::phase
    S13 & S14 & S15 & S16 --> PH6

    S17["S17: Final Review & Filing Checklist<br/>Completeness Â· Consistency across docs<br/>Regulatory compliance Â· Pipeline status"]:::aiStep
    S18["S18: Denial Probability Engine<br/>AAO patterns 2015â€“2025 Â· Field-specific rates<br/>Kazarian Step 1 & 2 assessment Â· Risk mitigation"]:::critical

    FINAL(["ğŸ¯ PETITION PACKAGE READY<br/>All documents generated Â· Reviewed Â· Risk-assessed<br/>Ready for attorney review & USCIS filing"]):::output

    PH6 --> S17
    S17 --> S18
    S18 --> FINAL
